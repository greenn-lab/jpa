# 04. ì—”í‹°í‹° ë§¤í•‘

## ëª©ì°¨
1. @Entity
2. @Table
3. ë‹¤ì–‘í•œ ë§¤í•‘ ì‚¬ìš©
4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±
5. DDL ìƒì„± ê¸°ëŠ¥
6. ê¸°ë³¸ í‚¤ ë§¤í•‘
7. í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: ë ˆí¼ëŸ°ìŠ¤


## 1. @Entity
ì—”í‹°í‹°ë¡œ ì‚¬ìš©í•  í´ë˜ìŠ¤ëŠ” `@Entity` ë¥¼ ê¼­ ë¶™ì—¬ì•¼ í•¨.
| ì†ì„±   | ê¸°ëŠ¥                                          | ê¸°ë³¸ê°’                 |
| ---- | ------------------------------------------- | ------------------- |
| name | JPAì—ì„œ ì‚¬ìš©í•  ì—”í‹°í‹° ì´ë¦„. ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì— ê°™ì€ ì´ë¦„ì´ ì¡´ì¬í•œë‹¤ë©´ ë¬´ì‹œí•¨. | í´ë˜ìŠ¤ ëª…ì¹­ (ex. Member) |

***ì£¼ì˜ì‚¬í•­***
- ê¸°ë³¸ ìƒì„±ìëŠ” í•„ìˆ˜!
- final, enum, interface, inner í´ë˜ìŠ¤ëŠ” ì•ˆë¨.
- ì»¬ëŸ¼ í•„ë“œê°€ final ì´ë©´ ì•ˆë¨.
  
## 2. @Table
ì—”í‹°í‹° ê°ì²´ì™€ ë§¤í•‘í•  RDBì˜ í…Œì´ë¸”ì„ ì§€ì •. 

| ì†ì„±                | ê¸°ëŠ¥                                                                                                                                           | ê¸°ë³¸ê°’        |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ---------- |
| name              | ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„                                                                                                                                   | ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš© |
| catalog           | [RDB catalog](https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%EC%B9%B4%ED%83%88%EB%A1%9C%EA%B7%B8)ì— ë§¤í•‘ |            |
| schema            | [RDB schema](https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%EC%8A%A4%ED%82%A4%EB%A7%88)ì— ë§¤í•‘           |            |
| uniqueConstraints | DDL ìƒì„± í•  ë•Œ, ìœ ì¼ ê°’(unique) ì œì•½ì¡°ê±´ ë§Œë“¬.                                                                                                            |            |

## 3. ë‹¤ì–‘í•œ ë§¤í•‘ ì‚¬ìš©
```java
@Entity
@Table(name = "MEMBER")
@Data
class Member {
  @Id
  @Column(name = "ID")
  private String id;

  @Column(name = "NAME")
  private String name;

  private Integer age;

  @Enumerated(EnumType.STRING)
  private RoleType roleType;

  @Temporal(TemporalType.TIMESTAMP)
  private Date createdDate;

  @Temporal(TemporalType.TIMESTAMP)
  private Date lastModifiedDate;

  @Lob
  private String description;

  public static enum RoleType {
    ADMIN, USER
  }
}
```

## 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±
| ì˜µì…˜          | ì„¤ëª…                                      |
| ----------- | --------------------------------------- |
| create      | ê¸°ì¡´ í…Œì´ë¸”ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œ ìƒì„±                      |
| create-drop | create ì˜µì…˜ì— ì¶”ê°€ë¡œ ì¢…ë£Œí•  ë•Œ ì‚­ì œ                 |
| update      | RDB í…Œì´ë¸”ê³¼ ì—”í‹°í‹° ë§¤í•‘ì •ë³´ë¥¼ ë¹„êµí•´ì„œ **ë³€ê²½ì‚¬í•­ë§Œ ìˆ˜ì •**    |
| validate    | RDB í…Œì´ë¸”ê³¼ ì—”í‹°í‹° ë§¤í•‘ì •ë³´ë¥¼ ë¹„êµí•´ì„œ í‹€ë¦¬ë©´ ExceptionğŸ˜± |
| none        | ìë™ ìƒì„± ì•ˆí•¨.                               |


## 5. DDL ìƒì„± ê¸°ëŠ¥
`@Column` ì— DDL ì†ì„± ì •ì˜
```java
@Entity
public class Member {
  @Id
  private String id;

  @Column(name = "NM", nullable = false, length = 10)
  private String username;
}
```

`@Table` ì— ìœ ì¼ê°’ ì œì•½ì¡°ê±´ ì •ì˜
```java
@Entity
@Table(uniqueConstraints = {
  @UniqueConstraint(  
    name = "MEMBER_NM_AGE_UQ",
    columnNames = {"NM", "AGE"}
  )
})
public class Member { ... }
```

## 6. ê¸°ë³¸ í‚¤ ë§¤í•‘
ê¸°ë³¸ í‚¤(Primary Key) ë§¤í•‘ ì¢…ë£Œ
- **ì§ì ‘ í• ë‹¹** ê°œë°œìê°€ ì•Œì•„ì„œ ê°’ì„ ë„£ì–´ ì¤Œ. ~~ì™œ ê·¸ëŸ°ì§“ì„??~~
- **ìë™ ìƒì„±** ëŒ€ë¦¬ í‚¤ ì‚¬ìš© ë°©ì‹
  - **IDENTIFY** RDBì— ìœ„ì„
  - **SEQUENCE** ì‹œí€€ìŠ¤ ê¸°ëŠ¥ì„ ì‚¬ìš©
  - **TABLE** í‚¤ ìƒì„± í…Œì´ë¸”

### 6.1 ê¸°ë³¸ í‚¤ ì§ì ‘ í• ë‹¹ ì „ëµ
ì§ì ‘ í• ë‹¹ í•˜ë ¤ë©´ `@Id` ë¡œ ë§¤í•‘í•˜ë©´ ë¨.
```java
@Id
private Long id;
```
`@Id` ë¥¼ ì ìš© ê°€ëŠ¥í•œ ìë°” íƒ€ì…ì€
- ìë°” ê¸°ë³¸í˜• primitive types (byte, char, short, int, long, float, double, boolean)
- ìë°” ë˜í¼í˜• (Byte, Character, Short, Integer, Long, Float, Double, Boolean)
- String
- java.util.Date
- java.sql.Date
- java.math.BigDecimal
- java.math.BigInteger
  
### 6.2 IDENTIFY ì „ëµ
RDBê°€ ì•Œì•„ì„œ ì²˜ë¦¬ í•´ì£¼ëŠ” ê²½ìš° ì‚¬ìš© ê°€ëŠ¥.  
MySQL, PostgreSQL, SQL Server, DB2 ì—ì„œ ì‚¬ìš©.
ì˜ˆë¥¼ ë“¤ë©´ MySQLì˜ auto_increment
```java
@Entity
class Board {
  @Id
  @GeneratedVAlue(strategy = GenerationType.IDENTITY)
  private Long id;

  ...
}
```
```java
Board board = new Board();

em.persist(board);

board.getId(); // "1"
```

### 6.3 SEQUENCE ì „ëµ
Oracle, PostgreSQL, DB2, H2 ì‚¬ìš©
```sql
CREATE TABLE BOARD (
  ID BIGINT NOT NULL PRIMARY KEY,
  DATA VARCHAR(255)
);

CREATE SEQUENCE BOARD_ID_SQ START WITH 1;
```
ìœ„ì™€ ê°™ì´ ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í–ˆìœ¼ë©´,
```java
@Entity
@SequenceGenerator(
  name = "BOARD_SEQ_GENERATOR",
  sequenceName = "BOARD_ID_SQ",
  initialValue = 1
)
class Board {
  @Id
  @GeneratedValue(  
    strategy = GenerationType.SEQUENCE,
    generator = "BOARD_SEQ_GENERATOR"
  )
  private Long id;

  ...
}
```
ì´ë ‡ê²Œ ì‚¬ìš©í•¨.

#### @SequenceGenerator
| ì†ì„±              | ê¸°ëŠ¥                             | ê¸°ë³¸ ê°’               |
| --------------- | ------------------------------ | ------------------ |
| name            | ì‹ë³„ì ì´ë¦„(ì›í•˜ëŠ” ëŒ€ë¡œ)                 | required!          |
| sequenceName    | RDBì— ë“±ë¡ë˜ì–´ ìˆëŠ” ì‹œí€€ìŠ¤ ì´ë¦„            | hibernate_sequence |
| initialValue    | DDL ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë¨. START WITH (n) | 1                  |
| allocationSize  | ì¦ê°€í•˜ëŠ” ìˆ˜                         | 50                 |
| catalog, schema | RDBì˜ catalog, schema ì´ë¦„        |                    |

### 6.4 TABLE ì „ëµ
í‚¤ ìƒì„± ì „ìš©í…Œì´ë¸”ì„ ë§Œë“¤ì–´ RDBì˜ ì‹œí€€ìŠ¤ë¥¼ í‰ë‚´ë‚´ëŠ” ì „ëµ. ëª¨ë“  RDB ë²¤ë”ì— ì ìš©í•  ìˆ˜ ìˆìŒ.  
  
*í‚¤ ìƒì„± ì „ìš©í…Œì´ë¸”*
```sql
CREATE TABLE OUR_SEQUENCES (
  SEQUENCE_NAME VARCHAR(255) PRIMARY KEY,
  NEXT_VAL BIGINT
)
```
```java
@Entity
@TableGenerator(
  name = "BOARD_SEQ_GENERATOR",
  table = "OUT_SEQUENCES",
  pkColumnVAlue = "BOARD_ID_SQ",
  allocationSize = 1
)
class Board {
  @Id
  @GeneratedVAlue(
    strategy = GenerationType.TABLE
  )
  private Long id;

  ...
}
```
#### @TableGenerator
| ì†ì„±               | ê¸°ëŠ¥                      | ê¸°ë³¸ ê°’               |
| ---------------- | ----------------------- | ------------------ |
| name             | ì‹ë³„ì ì´ë¦„                  | required           |
| table            | í‚¤ ìƒì„± í…Œì´ë¸” ì´ë¦„             | hibernate_sequence |
| pkColumnName     | ì‹œí€€ìŠ¤ ì»¬ëŸ¼                  | sequence_name      |
| valueColumnName  | ì‹œí€€ìŠ¤ ê°’ ì»¬ëŸ¼                | next_val           |
| pkColumnValue    | í‚¤ë¡œ ì‚¬ìš©í•  ê°’ ì´ë¦„             | ì—”í‹°í‹° ì´ë¦„             |
| initialValue     | ì‹œí€€ìŠ¤ ì‹œì‘ ê°’                | 0                  |
| allocationSize   | ì¦ê°€í•˜ëŠ” ìˆ˜                  | 50                 |
| catalog, schema  | RDBì˜ catalog, schema ì´ë¦„ |                    |
| uniqueConstrains | ìœ ì¼ ê°’ ì œì•½ì¡°ê±´ì„ ì§€ì •           |                    |

### 6.5 AUTO ì „ëµ
RDB ë²¤ë”ì— ë§ì¶°ì„œ ì•Œì•„ì„œ í•´ì¤Œ.
ë°©ì–¸ì— ë”°ë¼ì„œ IDENTITY, SEQUENCE, TABLE ì „ëµì¤‘ í•˜ë‚˜ë¥¼ ìë™ìœ¼ë¡œ ì„ íƒ.
```java
@Entity
class Entity {
  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private Long id;

  ...
}
```
`@GeneratedValue`ì˜ strategy ì†ì„±ì˜ ê¸°ë³¸ ê°’ìœ¼ **AUTO** ì„. ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë¨.
```java
@Id
@GeneratoredValue
private Long id;
```

### 7. í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: ë ˆí¼ëŸ°ìŠ¤
<table>
  <thead>
    <tr>
      <th>type</th>
      <th>annotation</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="5">í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘</td>
      <td>@Column</td>
      <td>ì»¬ëŸ¼ì„ ë§¤í•‘</td>
    </tr>
    <tr>
      <td>@Enumerated</td>
      <td>enum íƒ€ì…ì„ ë§¤í•‘</td>
    </tr>
    <tr>
      <td>@Temporal</td>
      <td>ë‚ ì§œ íƒ€ì… ë§¤í•‘</td>
    </tr>
    <tr>
      <td>@Lob</td>
      <td>BLOB, CLOB íƒ€ì… ë§¤í•‘</td>
    </tr>
    <tr>
      <td>@Transient</td>
      <td>ë§¤í•‘ ì•ˆí•¨!</td>
    </tr>
    <tr>
      <td>ê¸°íƒ€</td>
      <td>@Access</td>
      <td>JPAê°€ ì—”í‹°í‹°ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ ì§€ì •</td>
    </tr>
  </tbody>
</table>

#### 7.1 @Column
| ì†ì„±               | ê¸°ëŠ¥                                                                            | ê¸°ë³¸ ê°’                  |
| ---------------- | ----------------------------------------------------------------------------- | --------------------- |
| name             | ë§¤í•‘í•  ì»¬ëŸ¼ ì´ë¦„                                                                     | í•„ë“œ ì´ë¦„ ê·¸ëŒ€ë¡œ             |
| insertable       | ì €ì¥í•  ë•Œ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸. false ë¥¼ ì¨ì„œ ì½ê¸°ì „ìš©ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŒ                                      | true                  |
| updatable        | ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸. false ë¥¼ ì¨ì„œ ì½ê¸°ì „ìš©ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŒ                                      | true                  |
| table            | í•˜ë‚˜ì˜ ì—”í‹°í‹°ë¥¼ ë‹¤ ìˆ˜ì˜ í…Œì´ë¸”ì— ë§¤í•‘í•  ë•Œ ì‚¬ìš©.                                                  | í˜„ì¬ í´ë˜ìŠ¤ê°€ ë§¤í•‘ëœ í…Œì´ë¸”       |
| nullable         | DDLì „ìš©. null í—ˆìš© ì—¬ë¶€                                                             | true                  |
| unique           | DDLì „ìš©. ìœ ì¼ ê°’ ì„¤ì •                                                                |
| columnDefinition | DDLì „ìš©. ì»¬ëŸ¼ ìŠ¤í‚¤ë§ˆë¥¼ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆìŒ                                                    |                       |
| length           | ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´                                                                    | 255                   |
| precision,scale  | DDLì „ìš©. BigDecimal, BigInteger íƒ€ì…ì—ì„œ ì‚¬ìš©.precisionì€ ì†Œìˆ˜ì  í¬í•¨í•œ ê¸¸ì´, scaleì€ ì†Œìˆ˜ì ì˜ ìë¦¿ ìˆ˜ | precision=19, scale=2 |

#### 7.2 @Enumerated
| ì†ì„±    | ê¸°ëŠ¥                                               | ê¸°ë³¸ê°’              |
| ----- | ------------------------------------------------ | ---------------- |
| value | EnumType.ORDINAL: ìˆœì„œëŒ€ë¡œ,<br>EnumType.STRING: ì´ë¦„ìœ¼ë¡œ | EnumType.ORDINAL |

#### 7.3 @Temporal
ë‚ ì§œ íƒ€ì…(java.util.Date, java.util.Calendar)ì„ ë§¤í•‘
| ì†ì„±    | ê¸°ëŠ¥                                                                                                                                                                | ê¸°ë³¸ ê°’     |
| ----- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| value | TemporalType.DATE: RDBì˜ date íƒ€ì…ê³¼ ë§¤í•‘(ex. 2019-03-21)<br>TemporalType.TIME: RDBì˜ time íƒ€ì…ê³¼ ë§¤í•‘(ex. 13:55:59)<br>TemporalType.TIMESTAMP: ë‚ ì§œì™€ ì‹œê°„. RDBì˜ timestamp íƒ€ì…ê³¼ ë§¤í•‘ | required |

#### 7.4 @Lob
ë‹¤ìŒê³¼ ê°™ì´ ë§¤í•‘
- **CLOB** String, char[], java.sql.Clob
- **BLOB** byte[], java.sql.Blob


#### 7.5 @Transient
ì´ í•„ë“œëŠ” ë§¤í•‘í•˜ì§€ ì•ŠìŒ.  
ê°ì²´ì— ì„ì‹œë¡œ ì–´ë–¤ ê°’ì„ ë³´ê´€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

#### 7.6 @Access
- **í•„ë“œ ì ‘ê·¼** `AccessType.FIELD` ë¡œ ì§€ì •. í•„ë“œì— ì§ì ‘ ì§€ì •í•˜ê³ , private ì ‘ê·¼ìë„ ê°€ëŠ¥
- **í”„ë¡œí¼í‹° ì ‘ê·¼** `AccessType.PROPERTY` ë¡œ ì§€ì •. Getter ë©”ì†Œë“œì— ì‚¬ìš©

```java
@Entity
@Access(AccessType.FIELD)
class Member {
  @Id
  private String id;

  private String data1;
  private String data2;

  ...
}
```
```java
@Entity
@Access(AccessType.PROPERTY)
class Member {
  private String id;
  private String data;

  @Id
  public String getId() {
    return id;
  }

  @Column
  public String getData() {
    return data;
  }

  ...
}
```

> `@Id` ê°€ í•„ë“œì— ìˆëŠ”ì§€ í”„ë¡œí¼í‹°ì— ìˆëŠ”ì§€ë¥¼ ê°€ì§€ê³  ì•Œì•„ì„œ FIELD ë˜ëŠ” PROPERTY ë¥¼ êµ¬ë¶„í•´ì¤Œ.  
> ë”°ë¡œ ì“¸í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì–˜ê¸°.

```java
@Entity
class Member {
  @Id
  private String id;

  @Transient
  private String firstName;

  @Transient
  private String lastName;

  @Access(AccessType.PROPERTY)
  public String getFullName() {
    return firstName + lastName;
  }

}
```
ì´ë ‡ê²Œ ìœ„ì™€ê°™ì´ í˜¼ìš©í•´ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆìŒ.
# ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´

## 1. ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ

### 1.1 JPQL ì†Œê°œ

- DB ë²¤ë”ì— ì˜ì¡´í•˜ì§€ ì•Šê³ 
- SQL ë³´ë‹¤ ê°„ê²°í•˜ëŒ€ìš”.

```java
String jpql = "select m from Member as m where m.username = 'kim'";
List<Member> resultList = em.createQuery(jpql, Member.class).getResultList();
```

### 1.2 Criteria ì¿¼ë¦¬ ì†Œê°œ

`String` ìœ¼ë¡œ ì‘ì„±í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ `query.select(m).where(...)` ì´ë ‡ê²Œ ì½”ë“œë¡œ ì‘ì„±

- ë™ì ì¿¼ë¦¬ ì‘ì„±ì´ ì‰½ê³ 
- IDE ë¥¼ í†µí•´ Auto Intellisence ë¥¼ ì“°ê³ 
- ì»´íŒŒì¼(ë˜ëŠ” ì‘ì„±) ì‹œì ì— ì˜¤ë¥˜ í™•ì¸ í•  ìˆ˜ ìˆì–´ìš”.

```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);

Root<Member> m = query.from(Member.class);

CriteriaQuery<Member> cq = query.select(m).wehre(cb.equal(m.get("username"), "kim"));
List<Member> resultList = em.createQuery(cq).getResultList();
```

ì•„ì§ì€ ë­”ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ì´ë ‡ê²Œ í•˜ëŠ” ê±°ë˜ìš”. ë­”ê°€ ë³µì¡í•˜êµ°ìš”.  
ì±…ì—ì„œë„ **"ëª¨ë“  ì¥ì ì„ ìƒì‡„í•  ì •ë„ë¡ ë³µì¡í•˜ë‹¤"** ë¼ê³  ë§í•˜ë„¤ìš”. í¬ë‚˜í° ë‹¨ì .

### 1.3 QueryDSL ì†Œê°œ

> JPA í‘œì¤€ì€ ì•„ë‹ˆê³  ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë˜ìš”. MongoDB, Java Collection, Lucene, Hibernate Search ë„ ê±°ì˜ ê°™ì€ ë¬¸ë²•ìœ¼ë¡œ ì§€ì›í•˜ê³ ìš”.

```java
JPAQuery queyr = new JPAQuery(em);
QMember member = QMember.member;

List<Member members = query.from(member)
                        .where(member.username.eq("kim"))
                        .list(member);
```

### 1.4 ë„¤ì´í‹°ë¸Œ SQL ì†Œê°œ

íŠ¹ì • DB vendorì— ì¢…ì†ì ì¸ ê¸°ëŠ¥ ìˆ˜í–‰ ë“±, ì•„ë¬´íŠ¼ ê·¸ëƒ¥ SQLì„ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•˜ëŠ” ê±°ì—ìš”.

```java
STring sql = "SELECT ID, AGE FROM MEMBER = NAME = 'kim'";
List<Member> resultList = em.createNativeQuery(sql, Member.class).getResultList();
```

### 1.5 JDBC ì§ì ‘ ì‚¬ìš©, ë§ˆì´ë°”í‹°ìŠ¤ ê°™ì€ SQL ë§¤í¼ í”„ë˜ì„ì›Œí¬ ì‚¬ìš©

JPAë‘ ë”°ë¡œ ë†€ê²Œ ì‚¬ìš©ë˜ë©´ ë°ì´í„° ë¬´ê²°ì„±ì´ ì†ìƒë  ìˆ˜ ìˆê² ë‹¨ ì–˜ê¸¸ í•˜ë„¤ìš”. ë‹¹ì—°íˆë„ ê·¸ëŸ¬ê² ì£ . ê·¸ë˜ì„œ JPA ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë™ê¸°í™”(ì ì ˆí•œ ì‹œì ì— `em.flush()` ë¥¼ ë‚ ë ¤ì„œ)í•´ì„œ ì“°ë¼ê³  í•˜ë„¤ìš”.

<br>

## 2. JPQL

íŠ¹ì§•ì„ ë§í•˜ìë©´,

- ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ í•˜ê³ ,
- ì¶”ìƒí™” ë˜ì–´ ìˆì–´ì„œ, íŠ¹ì • DBMSì— ì˜ì¡´ì ì´ì§€ ì•Šê³ ,
- ê²°êµ­ì€ SQLë¡œ ë³€í™˜ëœëŒ€ìš”.

![](10_001.svg)  
ì´ê±¸ë¡œ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ ë³´ë ¤ë‚˜ ë´ìš”.

### 2.1 ê¸°ë³¸ ë¬¸ë²•ê³¼ ì¿¼ë¦¬ API

JPQL ì—ëŠ” `SELECT`, `UPDATE`, `DELETE` êµ¬ë¶„ì´ ìˆê³  ì €ì¥ì€ `EntityManager.persist(...)` ì„ ì‚¬ìš©í•˜ë‹ˆê¹Œ `INSERT` ëŠ” ì—†ëŒ€ìš”.

**ëŒ€ì†Œë¬¸ì êµ¬ë¶„**í•˜ëŠ”ë°, í´ë˜ìŠ¤ë‚˜ í•„ë“œëª…ë§Œ ê·¸ë ‡ê³  `SELECT`, `FROM`, `AS` ê°™ì€ ê±´ êµ¬ë¶„ ì•ˆí•œëŒ€ìš”.  
**ì—”í‹°í‹° ì´ë¦„**ìœ¼ë¡œ `FROM` ì ˆì— ì‚¬ìš©í•œëŒ€ìš”.  
**ë³„ì¹­ì€ í•„ìˆ˜**ë¡œ ìˆì–´ì•¼ í•œëŒ€ìš”.

ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì•Œë©´ `TypeQuery`, ì•„ë‹˜ ê·¸ëƒ¥ `Query` ì“´ëŒ€ìš”.

```java
String jpql = "SELECT m FROM Member m";

TypedQuery<Member> q = em.createQuery(jpql, Member.class);
List<Member> members = q.getResultList();

Query q = em.createQuery(jpql);
List members = query.getResultList();
```

ì¡°íšŒ í›„ ê²°ê³¼ ë°˜í™˜ APIëŠ” `q.getResultList()` ë‘ `q.getSingleResult()` ê°€ ìˆëŒ€ìš”.
(ì‹±ê¸€ì€ ì—†ê±°ë‚˜, ê²°ê³¼ ê°¯ìˆ˜ê°€ 1ì´ ì•„ë‹ˆë©´ `javax.persistence.NoResultException` í•˜ê³  `javax.persistence.NonUniqueResultException`)

### 2.2 íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

"ì´ë¦„"ê³¼ "ìœ„ì¹˜" ê¸°ì¤€ íŒŒë¼ë¯¸í„°ê°€ ìˆëŒ€ìš”.

```java
List<Member> members = em
  .createQuery("SELECT m FROM Member m WHERE m.username = :username", Member.class)
  .setParameter("username", "greenb")
  .getResultList();
```

```java
List<Member> members = em
  .createQuery("SELECT m FROM Member m WHERE m.username = ?1", Member.class)
  .setParameter(1, "greenb")
  .getResultList();
```

### 2.3 í”„ë¡œì ì…˜

`SELECT` ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê±¸ **í”„ë¡œì ì…˜<sub>projection</sub>** ì´ë¼ê³  í•œëŒ€ìš”.

#### ì—”í‹°í‹° í”„ë¡œì ì…˜

```SQL
SELECT m FROM Member m // íšŒì›
```

```SQL
SELECT m.team FROM Member m // íŒ€
```

#### ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜

ì„ë² ë””ë“œ íƒ€ì…ì€ ì¡°íšŒì˜ ì‹œì‘ì ì´ ë  ìˆ˜ ì—†ë‹¤ëŠ” ì œì•½ì´ ìˆë‹¤ë„¤ìš”. ë²ˆê±°ë¡­ê²Œ...  
ê·¸ë˜ì„œ `Order` ì—ì„œ `o.address` ì´ë ‡ê²Œ ë¶ˆëŸ¬ ì™€ì•¼ë§Œ í•œëŒ€ìš”.

```java
String q = "SELECT o.address FROM Order o";
List<Address> addresses = em
    .createQuery(q, Address.class)
    .getResultList();
```

#### ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜

ìˆ«ì, ë¬¸ì, ë‚ ì§œ ê°™ì€ ê¸°ë³¸ ë°ì´í„° íƒ€ì…ì„ **ìŠ¤ì¹¼ë¼ íƒ€ì…** ì´ë¼ê³  í•œëŒ€ìš”. (ê¸ˆì‹œì´ˆë¬¸ì¸ë°.. í•™êµë¥¼ ìŠ¤ì¹¼ë¼ ë¼ê³  í–ˆë˜ê±° ì•„ë‹Œê°€?)

```java
List<String username = em
    .createQuery("SELECT username FROM Member m", String.class)
    .getResultList();
```

ì—¬ê¸°ì„œ ë°ì´í„° ì¤‘ë³µì„ ì œê±°í•˜ë ¤ë©´,

```java
SELECT DISTINCT username FROM Member m
```

`DISTINCT` êµ¬ë¬¸ì„ ì“¸ ìˆ˜ ìˆëŒ€ìš”.

#### ì—¬ëŸ¬ ê°’ ì¡°íšŒ

```java
Query query = em.createQuery("SELECT m.username, m.age FROM Member m");
List resultList = query.getResultList();

Iterator it = resultList.iterator();
whiel (it.hasNext()) {
  Object[] row = (Object[]) it.next();
  String username = (String) row[0];
  Integer age = (Integer) row[1];
}
```

í˜ë“œë„¤ìš”, `TypedQuery` ë¥¼ ì“¸ ìˆ˜ ì—†ìœ¼ë‹ˆê¹Œìš”.

#### new ëª…ë ¹ì–´

ë¶ˆí¸í•œê±´ ì—­ì‹œ ê·¹ë³µí•˜ë ¤ëŠ” ë³¸ëŠ¥ì„ ìê·¹í•˜ì£ .

```java
package pkg;

@AllArgsConstructor
static class UserDTO {
  private String username;
  private Integer age;
}
```

ì´ëŸ° DTOë¥¼ ì´ìš©í•´ì„œ,

```java
TypedQuery<UserDTO> q = em.createQuery("SELECT new pkg.UserDTO(m.username, m.age) FROM Member m", UserDTO.class);
List<UserDTO> resultList = q.getResultList();
```

ì§œì”~ ğŸ‘ğŸ‘ğŸ‘

### 2.4 í˜ì´ì§• API

```java
List<Member> members = em
    .createQuery("SELECT m FROM Member m", Member.class)
    .setFirstResult(10) // ì‹œì‘ìœ„ì¹˜. 0ë¶€í„° ì‹œì‘
    .setMaxResults(20) // ì¡°íšŒ ë°ì´í„° ìˆ˜
    .getResultList();
```

### 2.5 ì§‘í•©ê³¼ ì •ë ¬

```SQL
SELECT count(m),  // ê°¯ìˆ˜
       sum(m.age), // ë‚˜ì´ì˜ í•©
       avg(m.age), // ë‚˜ì´ì˜ í‰ê· 
       max(m.age), // ìµœëŒ€ ë‚˜ì´
       min(m.age)  // ìµœì†Œ ë‚˜ì´
  FROM Member m
```

ì§‘í•© í•¨ìˆ˜ë“¤ì€,

- `null` ê°’ì€ ë¬´ì‹œë¼ì„œ í†µê³„ì— ì¡íˆì§€ ì•Šê³  (DISTINCT ì—ì„œë„ ë¬´ì‹œ)
- ê°’ì´ ì—†ëŠ”ë°, `sum`,`age`,`max`,`min` ì„ ì“°ë©´ ê²°ê³¼ë„ `null`
- `count(DISTINCT m.age)` ì´ë ‡ê²Œ í•¨ìˆ˜ ì•ˆì—ë„ ì“¸ ìˆ˜ ìˆëŒ€ìš”. (ì„ë² ë””ë“œ íƒ€ì…ì€ ì§€ì› ì•ˆí•˜ê³ )

`GROUP BY`, `HAVING`, `ORDER BY` ëŠ” ì‚¬ìš©ë°©ì‹ì´ ë˜‘ê°™ë„¤ìš”, RDBë‘.

### 2.6 JPQL ì¡°ì¸

```java
List<Member> members = em
    .createQuery("SELECT m FROM Member m INNER JOIN m.team t WHERE t.name = :teamName")
    .setParameter("teamName", "A")
    .getResultList();
```

ì¡°ì¸ë„ ë¹„ìŠ·í•˜ì£ .

```SQL
SELECT m FROM Member LEFT [OUTER] JOIN m.team t
```

ì™¸ë¶€ ì¡°ì¸ì€ ì €ë ‡ê²Œ í•œëŒ€ìš”. `OUTER` ëŠ” SQLì—ì„œë„ ê·¸ë ‡ì§€ë§Œ ì—¬ê¸°ì„œë„ ìƒëµê°€ëŠ¥í•˜ëŒ€ìš”.  
ì»¬ë ‰ì…˜ ê°’ìœ¼ë¡œ ì¡°ì¸í•˜ëŠ” "ì»¬ë ‰ì…˜ ì¡°ì¸", ê´€ê³„ê°€ ì—†ì´ ì¡°ì¸ì„ í•˜ëŠ” "ì„¸íƒ€ ì¡°ì¸"ë„ ìˆë„¤ìš”.  
JPA 2.1 ë¶€í„°ëŠ” `JOIN ON` ì ˆì´ ìˆì–´ì„œ SQLê³¼ ì¢€ ë” ë¹„ìŠ·í•˜ê²Œ ì“¸ ìˆ˜ë„ ìˆë„¤ìš”.

### 2.7 í˜ì¹˜ ì¡°ì¸

JPQL ì—ì„œë§Œ ì“°ëŠ” ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ê¸°ëŠ¥ì´ë˜ìš”.
ì—¬ëŸ¬ê°€ì§€ ì¢‹ì€ ê¸°ëŠ¥ì´ ìˆêµ°ìš”. í•˜ì§€ë§Œ ìµœì í™”ì˜ ê´€ì ì—ì„œ ë²—ì–´ë‚˜ë©´ ì‚¬ìš©ì´ êº¼ë ¤ì§€ê² ì–´ìš”.

### 2.8 ê²½ë¡œ í‘œí˜„ì‹

`.` ì„ ì°ì„œì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê±°ë˜ìš”.

```sql
SELECT m.username
  FROM Member m
  JOIN m.team t
  JOIN m.orders o
 WHERE t.name = 'A'
```

`m.username` ì€ ìƒíƒœ í•„ë“œ,  
 `m.team` ì€ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œë¡œ `@ManyToOne`, `@OneToOne` ë¡œ ê´€ê³„ëœ ì—”í‹°í‹°  
 `m.orders` ëŠ” ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œë¡œ `@OneToMany` `@ManyToMany` ë¡œ ê´€ê³„ëœ ì»¬ë ‰ì…˜ ì—”í‹°í‹°êµ°ìš”.

```java
@Entity
class Member {
  @Id @GeneratedValue
  private Long id;

  private String username; // ìƒíƒœ í•„ë“œ
  private Integer age; // ìƒíƒœ í•„ë“œ

  @ManyToOne(...)
  private Team team; // ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ

  @OneToMany(...)
  private List<Order> order; // ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ
}
```

ìƒíƒœ í•„ë“œëŠ” ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì„ ë” í•  ìˆ˜ ì—†ê³ , ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œëŠ” ë¬µì‹œì ìœ¼ë¡œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚˜ë©´ì„œ ê³„ì† íƒìƒ‰ì´ ê°€ëŠ¥ í•˜ëŒ€ìš”. ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œëŠ” ë˜‘ê°™ì´ ë¬µì‹œì  ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚˜ëŠ”ë°, ë”ëŠ” íƒìƒ‰í•  ìˆ˜ ì—†ëŒ€ìš”. ë‹¨, `FROM` ì ˆì—ì„œ ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ìœ¼ë©´ ë³„ì¹­ìœ¼ë¡œ íƒìƒ‰ í•  ìˆ˜ ìˆê³ ìš”.

ìƒíƒœ í•„ë“œ ê²½ë¡œ íƒìƒ‰ì€ ì‰¬ìš´ë°, ë³µì¡í•œ
**ë‹¨ì¼ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰**ì„ ì •ë¦¬í•´ ë´…ì‹œë‹¤.

```SQL
SELECT o.member.team
  FROM Order o
 WHERE oproduct.name = 'product-a'
   AND o.address.city = 'incheon'
```

ì´ëŸ° JPQLì´ ì‹¤í–‰ë˜ë©´ ì‹¤ì œ SQLì€,

```SQL
    SELECT t.*
      FROM ORDERS O
INNER JOIN MEMBER M ON O.MEMBER_ID = M.ID
INNER JOIN TEAM T ON M.TEAM_ID = T.ID
INNER JOIN PRODUCT P ON O.PRODUCT_ID = P.ID
     WHERE P.NAME = 'product-a'
       AND O.CITY = 'incheon'
```

ì´ë ‡ê²Œ ì‹¤í–‰ ëœë°ìš”.

** ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰**ì€

```SQL
SELECT m.username
  FROM Team t
  JOIN t.members m
```

`join t.members m` ìœ¼ë¡œ ì»¬ë ‰ì…˜ì— ë³„ì¹­ì„ ì–»ê³ , ê±°ê¸°ì„œ ê²½ë¡œ íƒìƒ‰ì„ í•  ìˆ˜ ìˆëŠ” ê±°ì—ìš”.

ê²½ë¡œ íƒìƒ‰ì„ ì‚¬ìš©í•œ ë¬µì‹œì  ì¡°ì¸ ì‹œ ì£¼ì˜ì‚¬í•­ì€

- **í•­ìƒ ë‚´ë¶€ ì¡°ì¸** ì´ê³ ,
- ì»¬ë ‰ì…˜ì€ ê²½ë¡œ íƒìƒ‰ì˜ ë!
- ì£¼ë¡œ `SELECT`, `WHERE` ì—ì„œ ì‚¬ìš©í•˜ì§€ë§Œ ë¬µì‹œì ìœ¼ë¡œ ì¡°ì¸ë˜ë‹ˆê¹Œ `FROM` ì— ì˜í–¥ì„ ì¤€ëŒ€ìš”.

ê²°ë¡ ì ìœ¼ë¡œ, ì¡°ì¸ì´ ì„±ëŠ¥ì°¨ì— í° ì˜í–¥ì´ ìˆìœ¼ë‹ˆ ë¬µì‹œì ì¸ ì¡°ì¸ ë³´ë‹¤ ë¶„ì„ì— ì¢‹ì€ ëª…ì‹œì  ì¡°ì¸ì„ ì‚¬ìš©í•˜ë¼ê³  í•˜ë„¤ìš”.

### 2.9 ì„œë¸Œ ì¿¼ë¦¬

`WHERE`, `HAVING` ì ˆì—ì„œë§Œ ì‚¬ìš© í•  ìˆ˜ ìˆëŒ€ìš”. êµ¬í˜„ì²´ì— ë”°ë¼ ì¢€ ë‹¤ë¥¼ ìˆ˜ ìˆê³ ìš”.

```SQL
SELECT m
  FROM Member m
 WHERE m.age > (  SELECT avg(m2.age)
                    FROM Member m2 )
```

ì´ëŸ° ì‹ìœ¼ë¡œ ì“°ë©´ ë˜êµ°ìš”.  
`EXISTS` ì ˆì€,

```SQL
SELECT m
  FROM Member m
 WHERE EXISTS (  SELECT t
                   FROM m.team t
                  WHERE t.name = 'A'  )
```

ì´ëŸ¬ê³ ìš”.  
`IN` ì ˆì€,

```SQL
SELECT m
  FROM Team t
 WHERE t IN (  SELECT t2
                 FROM Team t2
                 JOIN t2.members m2
                WHERE m2.age >= 20  )
```

### 2.10 ì¡°ê±´ì‹

| ì¢…ë¥˜        | ì„¤ëª…                                              | ì˜ˆì‹œ                      |
| ----------- | ------------------------------------------------- | ------------------------- |
| ë¬¸ì        | ì‘ì€ ë”°ì˜´í‘œ ('ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë©´ 'ë¥¼ ë‘ë²ˆ `''` )  |                           |
| ìˆ«ì        | Long íƒ€ì…ì€ 1L, Double íƒ€ì…ì€ 1D, Float íƒ€ì…ì€ 1F |                           |
| ë‚ ì§œ        | DATE {d 'yyyy-MM-dd'}                             | {d'1234-01-31'}           |
|             | TIME {t 'hh:mm:ss'}                               | {t'12:34:56'}             |
|             | DATETIME {ts 'yyyy-MM-dd hh:mm:ss.f'}             | {ts'1234-01-31 12:34:56'} |
| Boolean     | TRUE ë‚˜ FALSE                                     |                           |
| Enum        | Signature(íŒ¨í‚¤ì§€ í¬í•¨í•œ ì „ì²´ ì´ë¦„)                | jpabook.MemberType.Admin  |
| ì—”í‹°í‹° íƒ€ì… | ì—”í‹°í‹°ì˜ íƒ€ì…ì„ í‘œí˜„, ì£¼ë¡œ ìƒì†ê³¼ ê´€ë ¨í•´ì„œ ì‚¬ìš©   | TYPE(m) = Member          |

JPQLì—ì„œ ì‚¬ìš©í•˜ëŠ” íƒ€ì…ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì´ ì—†ëŒ€ìš”.

**_ì—°ì‚°ì ìš°ì„ ìˆœìœ„_** ëŠ”,

1. ê²½ë¡œ íƒìƒ‰ ì—°ì‚° `.` (ì )
2. ìˆ˜í•™ ì—°ì‚° - `+(ì–‘ìˆ˜)`, `-(ìŒìˆ˜)`, `*`, `/`, `+`, `-`
3. ë¹„êµ ì—°ì‚° `=`, `>`, `>=`, `<`, `<=`, `<>`, `[NOT] BETWEEN`, `[NOT] LIKE`, `[NOT] IN`, `IS [NOT] NULL`, `IS [NOT] EMPTY`, `[NOT] MEMBER [OF]`, `[NOT] EXISTS`
4. ë…¼ë¦¬ ì—°ì‚° `NOT`, `AND`, `OR`

**_ë…¼ë¦¬ ì—°ì‚°_** ì—ì„œ,

- `AND` ëŠ” ë‘˜ë‹¤ ë§Œì¡±í•˜ë©´ ì°¸
- `OR` ëŠ” ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ë§Œì¡±í•´ë„ ì°¸
- `NOT` ì€ ì¡°ê±´ì‹ì˜ ê²°ê³¼ì˜ ë°˜ëŒ€

**_ë¹„êµì‹_** ì€,  
`=`, `>`, `>=`, `<`, `<=`, `<>` ì´ëŸ°ê²Œ ìˆë„¤ìš”.

**_BETWEEN, IN, LIKE, IS NULL_** ê°™ì€ SQLê³¼ ê°™ì€ ê²ƒë“¤ì´ ìˆê³ ,  
**_ì»¬ë ‰ì…˜ ì‹_** ì´ë¼ê³  ì»¬ë ‰ì…˜ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ”ê²Œ ìˆëŒ€ìš”.

```SQL
SELECT m
  FROM Member m
 WHERE m.orders IS NOT EMPTY
```

ì´ë ‡ê²Œ JPQL ì„ ì“°ë©´ SQLì€ ë‹¤ìŒì²˜ëŸ¼ ë‚˜ì˜¨ë‹¤ê³  í•˜ë„¤ìš”.

```SQL
SELECT *
  FROM MEMBER M
 WHERE EXISTS (  SELECT O.ID
                   FROM ORDERS O
                  WHERE O.MEMBER_ID = M.ID  )
```

**_ìŠ¤ì¹¼ë¼ ì‹_** ì´ë¼ê³  ìˆ«ì, ë¬¸ì, ë‚ ì§œ, case, ì—”í‹°í‹° íƒ€ì… ê°™ì€ ê°€ì¥ ê¸°ë³¸ì ì¸ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ì‹ì´ ìˆëŠ”ë°,  
 `+`, `-` ê°™ì€ ë‹¨í•­ ì—°ì‚°ì, ì‚¬ì¹™ì—°ì‚°ë“±ì´ ìˆì£ .

**_ë¬¸ìí•¨ìˆ˜_** ë„ ìˆëŠ”ë°,

- `CONCAT('A', 'B', ...)` --> "AB..."
- `SUBSTRING('ABCD', 2, 3)` --> "BCD"
- `TRIM(' ABC ')` --> "ABC"
- `LOWER('ABC')` --> "abc"
- `UPPER('abc')` --> "ABC"
- `LENGTH('ABC')` --> 3
- `LOCATE('C', 'ABC' [, 1])` --> 2

**_ìˆ˜í•™í•¨ìˆ˜_** ëŠ”,

- `ABS(-123)` --> ì ˆëŒ€ê°’ 123
- `SQRT(4)` --> ì œê³±ê·¼ 2.0
- `MOD(4, 3)` --> ë‚˜ë¨¸ì§€ 1
- `SIZE(t.members)` --> ì»¬ë ‰ì…˜ì˜ ê°¯ìˆ˜ n
- `INDEX(ë³„ì¹­)` --> List íƒ€ì… ì»¬ë ‰ì…˜ì˜ ìœ„ì¹˜ê°’ì„ êµ¬í•œëŒ€ìš”.

**_ë‚ ì§œí•¨ìˆ˜_** ëŠ”,

- `CURRENT_DATE` í˜„ì¬ ë‚ ì§œ
- `CURRENT_TIME` í˜„ì¬ ì‹œê°„
- `CURRENT_TIMESTAMP` í˜„ì¬ ë‚ ì§œ ì‹œê°„

**_CASE ì‹_** ì€ SQLê³¼ ë™ì¼í•˜ê³ , ì‹¬í”ŒCASE ë„ ìˆëŠ”ë° java switch...case ë‘ ë¹„ìŠ·í•˜ë„¤ìš”.

**_COALESCE_** ëŠ”

```SQL
 SELECT COALESCE(m.username, 'ë¬´ëª…')
   FROM Member m
```

`username` ì´ ì—†ìœ¼ë©´, `ë¬´ëª…` ì´ë¼ê³  ë‚˜ì˜¤ëŠ” ê±°.

**_NULLIF_** ëŠ”

```SQL
 SELECT NULLIF(m.username, 'ê´€ë¦¬ì')
   FROM Member m
```

`username` ì´ `ê´€ë¦¬ì` ë©´, `NULL`ì„ ë°˜í™˜í•˜ê³  ì•„ë‹ˆë©´ ê·¸ëƒ¥ `username` ë°˜í™˜í•©ë‹ˆë‹¤.

### 2.11 ë‹¤í˜•ì„± ì¿¼ë¦¬

`@Inheritance` ì¨ì„œ ë§Œë“  ë‹¤í˜•ì„± ì—”í‹°í‹°ê°€ ìˆìœ¼ë©´,

```java
@Entity
@Inheritence(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "DTYPE")
abstract class Item { ... }

@Entity
@DiscriminatorValue("B")
class Book extends Item { ... }
```

ì´ëŸ° í˜•íƒœë¥¼ JPQLë¡œ ì¡°íšŒ í•˜ë©´,

```java
List list = em.createQuery("SELECT i FROM Item i").getResultList();
```

ì´ëŸ¬ë©´ ì•Œì•„ì„œ ìì‹ë„ í•¨ê»˜ ì¡°íšŒí•œëŒ€ìš”.  
`@DiscriminatorColumn` ì€ ì¡°ê±´ìœ¼ë¡œ ë„£ì„ ìˆ˜ ì—†ì–´ì„œ

```SQL
SELECT i
  FROM Item i
 WHERE TYPE(i) IN (Book, Movie)
```

ì´ë ‡ê²Œ ì“¸ ìˆ˜ ìˆê³ ,

```SQL
SELECT i
  FROM Item i
 WHERE TREAT(i as Book).author = 'greenb'
```

ì´ë ‡ê²Œ ìºìŠ¤íŒ… ê°™ì´ ì“°ëŠ” `TREAT` ë¼ëŠ” ê²ƒë„ ìˆë„¤ìš”. (JPA 2.1ë¶€í„°)

### 2.12 ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ í˜¸ì¶œ

ì´ê²ƒë„ JPA 2.1 ë¶€í„° ì§€ì›í•œëŒ€ìš”. ë°©ì–¸ í´ë˜ìŠ¤ `H2Dialect` ê°™ì€ ê±¸ ìƒì†í•´ì„œ êµ¬í˜„í•˜ë©´ ë˜ê³ ,

```SQL
SELECT êµ¬í˜„í•œ_í•¨ìˆ˜ì´ë¦„(i.name)
  FROM Item i
```

ì´ë ‡ê²Œ ì“°ë©´ ëœëŒ€ìš”.

### 2.13 ê¸°íƒ€ ì •ë¦¬

DBì— ë”°ë¼ì„œ empty string ì„ `NULL` ë¡œ ì—¬ê¸°ëŠ”ê²Œ ìˆì–´ì„œ í™•ì¸í•˜ê³  ì“°ë˜ìš”.

`NULL` ì€ `IS NULL` ë¡œë§Œ true ê°€ ë  ìˆ˜ ìˆê³ , ë¹„êµ ì—°ì‚°ì´ë‚˜ ìˆ˜í•™ì  ê³„ì‚° ê²°ê³¼ê°€ `NULL` ì´ ë©ë‹ˆë‹¤.

### 2.14 ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©

`SELECT COUNT(m.id) FROM Member m` ì´ë‘  
`SELECT COUNT(m) FROM Member m` ê°™ì€ ê±°ë˜ìš”. ì‹¤í–‰ë˜ëŠ” SQLì´ ê°™ë‹¤ëŠ” ì–˜ê¸°.

ì´ê²ƒë„ ê°™ì€ ê±°ë˜ìš”.

```java
List list = em
    .createQuery("SELECT m FROM Member m WHERE m = :member")
    .setParameter("member", new Member(4L))
    .getResultList();
```

```java
List list = em
    .createQuery("SELECT m FROM Member m WHERE m.id = :id")
    .setParameter("id", 4L)
    .getResultList();
```

### 2.15 Named ì¿¼ë¦¬: ì •ì  ì¿¼ë¦¬

ê·¸ëƒ¥ ê¸°ì¡´ì— ë°”ë¡œ ì‘ì„±í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê±¸ **ë™ì ì¿¼ë¦¬** ë¼ê³  í•˜ê³ , ì´ë¦„í‘œë¥¼ ë‹¬ì•„ì„œ ë¯¸ë¦¬ ì •ì˜ í•´ë†“ê³  ì“°ëŠ” ê±¸ **ì •ì ì¿¼ë¦¬** ë¼ê³  í•œëŒ€ìš”.

```java
@Entity
@NamedQuery(
  name = "Member.findByUsername",
  query = "SELECT m FROM Member m WHERE m.username = :username"
)
class Member { ... }
```

ì´ë ‡ê²Œ ì—”í‹°í‹°ì—ë‹¤ê°€ ì •ì˜ë¥¼ í•˜ê³ ,

```java
List<Member> members = em
    .createNamedQuery("Member.findByUsername", Member.class)
    .setParameter("username", "greenb")
    .getResultList();
```

ì´ë ‡ê²Œ ì“°ë©´ ëœëŒ€ìš”. ì´ë¦„í‘œë¥¼ ë¶™ì¼ ë•Œ ì—”í‹°í‹°ëª…ì„ ê°™ì´ ì¨ì£¼ë©´ ì¢‹ì€ê²Œ `@NamedQuery(s)` ê°€ ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë‹ˆê¹Œ êµ¬ë³„í•˜ê¸° í¸í•´ì„œ ê·¸ë ‡ëŒ€ìš”.

XMLë¡œ ì •ì˜ í•´ì„œ ì“¸ ìˆ˜ë„ ìˆëŒ€ìš”.
xmlnsëŠ” http://xmlns.jcp.org/xml/ns/persistence/orm ì´ë‹ˆê¹ ì°¸ê³ í•´ì„œ ì“°ë©´ ë˜ê² ë„¤ìš”.

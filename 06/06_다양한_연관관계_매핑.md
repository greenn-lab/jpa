# ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘
ì—”í‹°í‹°ì˜ ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ ê³ ë ¤í• ê²Œ,
1. ë‹¤ì¤‘ì„±
2. ë‹¨ë°©í–¥, ì–‘ë°©í–¥
3. ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

#### ë‹¤ì¤‘ì„±
- ë‹¤ëŒ€ì¼(@ManyToOne)
- ì¼ëŒ€ë‹¤(@OneToMany)
- ì¼ëŒ€ì¼(@OneToOne)
- ë‹¤ëŒ€ë‹¤(@ManyToMany)

#### ë‹¨ë°©í–¥, ì–‘ë°©í–¥
ê°ì²´ëŠ” ì°¸ì¡°ìš© í•„ë“œë¥¼ ê°€ì§€ê³  ì—°ê´€ëœ ê°ì²´ë¥¼ ì¡°íšŒí•˜ì£ . ì„œë¡œê°€ ì°¸ì¡°í•˜ë©´ ì–‘ë°©í–¥, í•œìª½ì—ì„œë§Œ ì°¸ì¡°ë˜ë©´ ë‹¨ë°©í–¥ì´ê² ì£ .

#### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
í…Œì´ë¸”ê°„ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë…€ì„ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ì—ìš”. `mappedBy` ë¥¼ ì“°ì§€ ì•Šì€ ì°¸ì¡° í•„ë“œ(ë©”ì†Œë“œ)ê°€ ì£¼ì¸ì¸ ê±°ì£ .

## 1. ë‹¤ëŒ€ì¼
DB í…Œì´ë¸”ê°„ì˜ `ì¼(1)` ê³¼ `ë‹¤(N)` ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ `ë‹¤(N)` ìª½ì— ìˆëŒ€ìš”.

### 1.1 ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥(N:1)

![](06_1.svg)

```java
class Member {
  ...

  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;

  ...
}
```
`Member.team` í•„ë“œë¡œ `MEMBER` í…Œì´ë¸”ì˜ `TEAM_ID ì™¸ë˜ í‚¤` ë¥¼ ê´€ë¦¬ í•˜ëŠ”ê±°ì£ .

### 1.2 ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ (N:1, 1:N)

![](06_2.svg)

```java
@Entity
class Member {
  @Id @GeneratedValue
  @Column(name = "MEMBER_ID")
  private Long id;

  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;

  public void setTeam(Team team) {
    this.team = team;

    // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬(ë­”ë§?)
    if (!team.getMembers().contains(this))
      team.getMembers().add(this);
  }

  ...
}
```

```java
@Entity
class Team {
  @Id @GeneratedValue
  @Column(name = "TEAM_ID")
  private Long id;

  @OneToMany(mappedBy = "team")
  private List<Member> members = new ArrayList<>();

  public void addMember(Member member) {
    this.members.add(member);

    // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
    if (member.getTeam() != this)
      member.setTeam(this);
  }
}
```

#### ì–‘ë°©í–¥ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ *ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸* ì´ë‹¤.
`Member.team` í•„ë“œê°€ ì—°ê´€ê´€ê³„ ì£¼ì¸, `Team.members` ëŠ” ì¡°íšŒ í• ë•Œë§Œ ì“°ëŠ” ì•„ì´.

#### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œë¥¼ ì°¸ì¡°í•´ì•¼ í•œë‹¤.
í•­ìƒ ì„œë¡œ ì°¸ì¡°í•˜ê²Œ í•˜ë ¤ë©´ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²Œ ì¢‹ë‹¤ë„¤ìš”.  
`Member.setTeam(...)`, `Team.addMember(...)` ê°™ì€ ê±°.
ê·¼ë° ì—¬ê¸°ì„œ ë¬´í•œë£¨í”„ì— ë¹ ì§€ë‹ˆê¹Œ ì£¼ì˜í•˜ë˜ìš”. ì–´ë–¡í•˜ë©´ ë¬´í•œë£¨í”„ì£ ?!

<br>

## 2. ì¼ëŒ€ë‹¤
ë‹¤ëŒ€ì¼ì˜ ë°˜ëŒ€. ì—”í‹°í‹°ê°€ í•˜ë‚˜ ì´ìƒ ì°¸ì¡° í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë‹ˆê¹Œ, Java Collection `Collection, List, Set, Map` ì¤‘ì—ì„œ ì„ íƒí•´ì„œ ì‚¬ìš©í•´ì•¼ ëœëŒ€ìš”.

### 2.1 ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥(1:N)

![](06_3.svg)

`Team.members` ë¡œ `MEMBER` í…Œì´ë¸”ì˜ `TEAM_ID` ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ê²Œ ë˜ë„¤ìš”. ì¢€ ì´ìƒí•´ ë³´ì´ê¸´ í•´ìš”.
```java
@Entity
class Team {
  ...

  @OneToMany
  @JoinColumn(name = "TEAM_ID") // MEMBER í…Œì´ë¸”ì˜ TEAM_ID(FK), ì§€ê¸ˆ ì—¬ê¸´ Team ì—”í‹°í‹´ë°...
  private List<Member> members = new ArrayList<>();

  ...
}
```
ì„±ëŠ¥ ë° ê´€ë¦¬ í¬ì¸íŠ¸ ë“± ë‹¨ì ì´ ë§ë‹¤ê³  í•˜ë„¤ìš”. ì–´ì°¨í”¼ DB í…Œì´ë¸”ìƒì˜ ê´€ê³„ëŠ” ë˜‘ê°™ê³  ì—”í‹°í‹° ì •ì˜ë§Œ ì˜ í•˜ë©´ ë˜ëŠ” ë¶€ë¶„ì´ë‹ˆê¹Œ ê°€ëŠ¥í•˜ë©´ **ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©**í•˜ìë„¤ìš”.  
(ì €ìëŠ” ê¶Œì¥ì„ í•˜ë©´ì„œë„ ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ë¶€ë¶„ì´ ìˆì„ ìˆ˜ ìˆë‹¤ê³  í–ˆëŠ”ë°, ì–¼í• ìƒê°ë˜ëŠ” ê²½ìš°ê°€ ì—†ì–´ì„œ... ê°™ì´ ì–˜ê¸°í•´ë´ìš”.)

### 2.2 ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ (1:N, N:1)
ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ ë§¤í•‘ì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ëŒ€ìš”. ê·¸ë ‡ë‹¤ë©´ ì™œ ì´ë²ˆ ë‹¨ë½ì„ ë§Œë“¤ì—ˆì„ê¹Œìš”? ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ëŒ€ì‹  ì‚¬ìš©í•œëŒ€ìš”. ì–´ì°Œëê±´ ë‘˜ë‹¤ ê°™ì€ ë§ì´ë¼ëŠ”ë°... ì¼ë‹¨ ë” ë³´ì‹œì£ .

![](06_4.svg)

```java
@Entity
class Team {
  ...

  @OneToMany
  @JoinColumn(name = "TEAM_ID")
  private List<Member> members = new ArrayList<>();

  ...
}
```
```java
@Entity
class Member {
  ...

  @ManyToOne
  @JoinColumn(name = "TEAM_ID", insertable = false, updatable= false)
  private Team team;

  ...
}
```
ì´ë ‡ê²Œ ì—”í‹°í‹° ë§¤í•‘ì„ í•˜ê²Œ ë˜ëŠ”ë°, ë¬¸ì œëŠ” **ë‘˜ë‹¤ ê°™ì€ ì™¸ë˜í‚¤ í‚¤ë¥¼ ê´€ë¦¬**í•˜ê²Œ ë˜ëŠ”ê±°ì—ìš”. ê·¸ë˜ì„œ `insertable = false, updatable = false` ë¥¼ ì„¤ì •í•´ì„œ **ë‹¤ëŒ€ì¼ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**í•˜ê²Œ í•´ì¤˜ì•¼ í•˜ì£ .

## 3. ì¼ëŒ€ì¼(1:1)
- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ë°˜ëŒ€ë„ ì¼ëŒ€ì¼ ê´€ê³„
- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ë‘˜ ì¤‘ ì•„ë¬´ê³³ì—ì„œë‚˜ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§

### 3.1 ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ 

#### ë‹¨ë°©í–¥

![](06_5.svg)

```java
@Entity
class Member {
  ...

  @OneToOne
  @JoinColumn(name = "LOCKER_ID")
  private Locker locker;

  ...
}
```
```java
@Entity
class Locker {
  @Id @GeneratedValue
  @Column(name = "LOCKER_ID")
  private Long id;
  private String name;

  ...
}
```

#### ì–‘ë°©í–¥

![](06_6.svg)

```java
@Entity
class Member {
  ...

  @OneToOne
  @JoinColumn(name = "LOCKER_ID")
  private Locker locker;

  ...
}
```
```java
@Entity
class Locker {
  ...

  @OneToOne(mappedBy = "locker")
  private Member member;

  ...
}
```
`Locker.member` ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë¼ê³  `@OneToOne(mappedBy = "locker")` ì´ë ‡ê²Œ ì„¤ì •í•´ì¤¬ë„¤ìš”.


### 3.2 ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

#### ë‹¨ë°©í–¥
JPAëŠ” ì´ëŸ°ê±°ëŠ” ì§€ì› ì•ˆí•œëŒ€ìš”. ìƒê°í•´ë´ë„ ì•ˆë˜ëŠ”ê²Œ ë§ëŠ”ê²ƒ ê°™ê³ ìš”.

#### ì–‘ë°©í–¥

![](06_7.svg)

```java
@Entity
class Member {
  ...

  @OneToOne(mappedBy= "member")
  private Locker locker;

  ...
}
```
```java
@Entity
class Locker {
  ...

  @OneToOne
  @JoinColumn(name = "MEMBER_ID")
  private Member member;


  ...
}
```

`Locker.member` ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸.


## 4. ë‹¤ëŒ€ë‹¤ (N:N)
RDBMSì—ì„œëŠ”  í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„ í•  ìˆ˜ ì—†ëŒ€ìš”. 

![](06_8.svg)

ê·¸ë˜ì„œ ì¤‘ê°„ì— ì—°ê²°í…Œì´ë¸”ì„ ë‘ê³  ì¼ëŒ€ë‹¤ì™€ ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ ì‚¬ìš©í•œë‹¤ë„¤ìš”.
í•˜ì§€ë§Œ ê°ì²´ëŠ” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ì£ .

![](06_9.svg)

`@ManyToMany` ë¥¼ ì‚¬ìš©í•´ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í¸ë¦¬í•˜ê²Œ ë§¤í•‘í•  ìˆ˜ ìˆëŒ€ìš”. (ë’¤ë¥¼ ì‚´ì§ ë´¤ëŠ”ë° ê·¸ë ‡ê²Œ í¸í•˜ì§„ ì•Šì€ë“¯.)

### 4.1 ë‹¤ëŒ€ë‹¤ ë‹¨ë°©í–¥

```java
@Entity
class Member {
  ...

  @ManyToMany
  @JoinTable(
    name = "MEMBER_PRODUCT",
    joinColumns = @JoinColumn(name = "MEMBER_ID"),
    inverseJoinColumns = @JoinColumn(name = "PRODUCT_ID")
  )
  private List<Product> products = new ArrayList<Product>();

  ...
}
```

```java
@Entity
class Product {
  @Id
  @Column(name = "PRODUCT_ID")
  private String id;

  ...
}
```

`@ManyToMany` ì™€ `@JoinTable` ì„ ì‚¬ìš©í•´ì„œ ì—°ê²° í…Œì´ë¸”ì„ ë°”ë¡œ ë§¤í•‘í•œëŒ€ìš”.
ì†ì„±ë“¤ ì •ë¦¬ë¥¼ í•´ë³´ë©´.
| ì†ì„±                 | ì„¤ëª…                             |
| ------------------ | ------------------------------ |
| name               | ì—°ê²° í…Œì´ë¸”ì„ ì§€ì •                     |
| joinColumns        | í˜„ì¬ ë°©í–¥(?)ì¸ íšŒì›ê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§€ì • |
| inverseJoinColumns | ë°˜ëŒ€ ë°©í–¥ì¸ ìƒí’ˆê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§€ì •    |

ë­, ë”± ë´ë„ ì§ê´€ì ìœ¼ë¡œ ì•Œêº¼ ê°™ê¸´ í•˜ë„¤ìš”.
ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•ŒëŠ”.
```java
void save() {
  Product product = new Product();
  product.setId("product-a");
  product.setName("ìƒí’ˆA");
  em.persist(product);

  Member member = new Member();
  member.setId("member1");
  member.setUsername("ë‚˜íšŒì›");
  member.setProducts().add(product); // ì—°ê´€ê´€ê³„ ì„¤ì •
  em.persist(member);
}
```
ì—­ì‹œ ì €ì¥í•˜ëŠ” ì½”ë“œë„ í‰ì´í•˜êµ°ìš”.  
ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ìœ¼ë¡œ ì¡°íšŒí•˜ê³  ì‹¤í–‰ SQLì´ ë‚˜ì˜¤ëŠ” ë‚´ìš©ì€ ìƒëµí• ê²Œìš”.

### 4.2 ë‹¤ëŒ€ë‹¤ ì–‘ë°©í–¥

`@ManyToMany` ë¥¼ ì¼ëŠ”ë° ì—­ë°©í–¥ ì—ë„ ì“°ë©´ ëœëŒ€ìš”. ë¬¼ë¡  ì†ì„±ì˜ `mappedBy` ë¥¼ ì§€ì •í•´ ì£¼ê³ ìš”.
```java
@Entity
class Product {
  ...

  @ManyToMany(mappedBy = "products") // ì—­ë°©í–¥ ì—°ê´€ê´€ê³„ ì¶”ê°€
  private List<Member> members;

  ...
}
```

### 4.3 ë‹¤ëŒ€ë‹¤: ë§¤í•‘ì˜ í•œê³„ì™€ ê·¹ë³µ, ì—°ê²° ì—”í‹°í‹° ì‚¬ìš©

`@ManyToMany` ëŠ” ì—°ê²° í…Œì´ë¸”ê³¼ ë§¤í•‘ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ë„ë©”ì¸ ëª¨ë¸ë„ ê¹”ë”í•´ì§€ëŠ” ë“± ì—¬ëŸ¬ëª¨ë¡œ í¸ë¦¬í•˜ëŒ€ìš”. ê·¸ë ‡ì§€ë§Œ ì´ëŸ° ë‹¨ìˆœí•¨ì´ ì‹¤ë¬´ì—” ì—†ì„ê±°ë¼ê³  ğŸ˜±  

![](06_10.svg)

ì´ë ‡ê²Œ ì—°ê²° í…Œì´ë¸”ì— ì¶”ê°€ëœ ì»¬ëŸ¼ì„ `@JoinTable` ë¡œëŠ” ê°ë‹¹í•  ìˆ˜ ì—†ëŠ” ê±°ê² ì£ .  
ê°ì²´ ì—°ê´€ê´€ê³„ë¥¼ ë°”ê¿”ì„œ ê·¹ë³µí•´ë³´ì•„ìš” ğŸ¤”

![](06_11.svg)

ì—°ê²° í…Œì´ë¸”ë„ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ ë§¤í•‘í•˜ê³ , ê¸°ì¡´ì— ë‹¤ëŒ€ë‹¤ ì˜€ë˜ ê±¸ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ë¡œ ë³€ê²½ í•´ì¤˜ì•¼ í•˜ê² êµ°ìš”.
```java
@Entity
class Member {
  ...

  @OneToMany(mappedBy = "member")
  private List<MemberProduct> memProds;

  ...
}
```
```java
@Entity
class Product {
  @Id
  @Column(name = "PRODUCT_ID")
  private Long id;
  private String name;

  ...
}
```
```java
@Entity
@IdClass(MemberProductID.class) // "ë³µí•© ê¸°ë³¸ í‚¤" ë¥¼ ì²˜ë¦¬
class MemberProduct {
  @Id
  @ManyToOne
  @JoinColumn(name = "MEMBER_ID")
  private Member member;

  @Id
  @ManyToOne
  @JoinColumn(name = "PRODUCT_ID")
  private Product product;

  private Integer orderAmount;
  private LocalDateTime orderDateTime;

  ...
}
```
```java
public class MemberProductID implements Serializable {
  private Long memberId;
  private Long productId;

  @Override
  public boolean equals(Object o) {
    if (o == this) return true;
    if (!(o instanceof MemberProductId)) return false;

    MemberProductId instance = (MemberProductId) o;
    return instance.memberId == memberId
        && instance.productId == productId;
  }

  @Override
  public int hashCode() {
    int hash = 1;
    hash *= 17 + memberId == null ? 0 : memberId;
    hash *= 17 + productId == null ? 0 : productId;
    return hash;
  }
}
```
ë³„ê±´ ì•„ë‹ˆêµ°ìš”.
ì˜¤íˆë ¤ "ë³µí•© ê¸°ë³¸ í‚¤" ë¼ëŠ” ê°œë…ì´ ë‚˜ì™€ì„œ ìƒì†Œí•œ ë“¯ í•˜ë‹ˆê¹Œ ì •ë¦¬í•´ ë³¼ê¹Œìš”.
- ë³µí•© ê¸°ë³¸ í‚¤ëŠ” ë³„ë„ì˜ ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ë§Œë“¬
- `java.lang.Serializable` ì„ êµ¬í˜„í•´ì•¼ í•¨
- `Object.equals(...)` ì™€ `Object.hashCode()` ë¥¼ êµ¬í˜„í•´ì•¼ í•¨
- ê¸°ë³¸ ìƒì„±ì ìˆì–´ì•¼ í•¨
- `public` ì ‘ê·¼ì ì‚¬ìš©í•´ì•¼ í•¨


### 4.4 ë‹¤ëŒ€ë‹¤: ìƒˆë¡œìš´ ê¸°ë³¸ í‚¤ ì‚¬ìš©
ì €ìê°€ ì¶”ì²œí•˜ëŠ” ê¸°ë³¸ ìƒì„± ì „ëµì€ DBì—ì„œ ìë™ ìƒì„±ë˜ëŠ” ëŒ€ë¦¬ í‚¤(`AUTO_INCREMENT` ë˜ëŠ” `SEQUENCE`)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê±°ë˜ìš”. ì¥ì ìœ¼ë¡œëŠ” ê±°ì˜ ì˜êµ¬ì ìœ¼ë¡œ ì“°ê³ , ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤ë„¤ìš”. ê°€ì¥ ì¢‹ì€ ì¥ì ì€ ì´ì „ ì²˜ëŸ¼ "ë³µí•© ê¸°ë³¸ í‚¤"ê°€ ì—†ì–´ ë§¤í•‘ì´ ê°„ê²°í•´ ì§„ë‹¤ëŠ” ì  ğŸ¤Ÿ

![](06_12.svg)

í…Œì´ë¸” ëª…ì¹­ë„ ë°”ê¿¨ì–´ìš”. `MEMBER_PRODUCT` ì—ì„œ `OTHERS` ë¡œ.  
ë‹¤ë¥¸ "ì‹ë³„ê´€ê³„"ë„ ì¡°ê¸ˆ ë°”ê¼ˆì£ .

```java
@Entity
@Table(name = "ORDERS") // DB syntax ì˜ ì˜ˆì•½ì–´ë¡œ "ORDER" ê°€ ìˆì–´ì„œ...
class Order {
  @Id @GeneratedValue
  @Column(name = "ORDER_ID")
  private Long id;

  @ManyToOne
  @JoinColumn(name = "MEMBER_ID")
  private Member member;

  @ManyToOne
  @JoinColumn(name = "PRODUCT_ID")
  private Product product;

  ...
}
```
```java
@Entity
class Member {
  ...

  @OneToMany(mappedBy = "member")
  private List<Order> orders = new ArrayList<>();

  ...
}
```
```java
@Entity
class Product {
  @Id
  @Column(name = "PRODUCT_ID")
  private Long id;
  private  String name;

  ...
}
```
ëŒ€ë¦¬í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ë§¤í•‘ì´ ê°„ê²°í•´ì§€ê³  ì´í•´í•˜ê¸° í¸í•´ì¡Œë‹¤ê³  ì €ìê»˜ì„œ ë§ì”€í•˜ì…¨ë‹¤.

---
ì°¸ì¡°ìë£Œ
 - [ì°¨íŠ¸](https://drive.google.com/file/d/14Ydy1eNT8Z5W2MI82RkcARZWhrFA6FQh/view?usp=sharing)